\documentclass[a4paper]{article}

\usepackage{microtype}
\usepackage[american]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[
  backend=biber,
  style=alphabetic,
  maxbibnames=99, % Ensure all authors are listed in the bibliography
  maxcitenames=2,
  useprefix=true, % Use prefixes (de, von, ...) in citation keys
  hyperref=true,
  backref=true,
  seconds=true,
  alldates=iso,
]{biblatex}
\usepackage{authblk}
\usepackage{mathtools}
\usepackage{bussproofs}
\usepackage{cmll}
\usepackage{csquotes}
\usepackage{enumitem}
\usepackage[only=llbracket,rrbracket]{stmaryrd}
\usepackage{tikz-cd}
\usepackage{keytheorems}
\usepackage[dvipsnames]{xcolor}
\usepackage{hyperref}

\colorlet{Highlight}{purple!85!black}
\colorlet{Url}{Aquamarine!85!black}
\colorlet{Cite}{YellowOrange!85!black}
\colorlet{Link}{violet!85!black}

\hypersetup{
  colorlinks=true,
  urlcolor=Url,
  citecolor=Cite,
  linkcolor=Link,
}

\NewDocumentCommand{\Highlight}{m}{\textcolor{Highlight}{#1}}

\NewDocumentCommand{\TypeTopology}{m O{}}{\href{https://www.cs.bham.ac.uk/~mhe/TypeTopology/#1.html\IfValueT{#2}{\##2}}{\texttt{#1}}}

\newkeytheoremstyle{boxed}{
  tcolorbox-no-titlebar={sharp corners=all,boxrule=1pt,colback=black!8},
}
\newkeytheoremstyle{boxed-definition}{
  inherit-style=boxed,
  numbered=false,
}
\newkeytheoremstyle{marked-definition}{
  inherit-style=definition,
  qed=$\lrcorner$,
}
\newkeytheoremstyle{construction}{
  inherit-style=definition,
  headfont={\itshape},
  qed=$\lrcorner$,
  numbered=false,
}
\newkeytheoremstyle{todo}{
  tcolorbox-no-titlebar={sharp corners=all,boxrule=1pt,colback=orange!10},
  numbered=false,
  headfont={\scshape},
}
\newkeytheorem{todo-block}[style=todo,name={Todo}]
\newkeytheorem{theorem}[style=plain,parent=section]
\newkeytheorem{
  proposition,
  lemma,
  corollary,
  problem,
  conjecture,
}[
  style=plain,
  sibling=theorem,
]
\newkeytheorem{definition}[style=marked-definition,sibling=theorem]
\newkeytheorem{construction}[style=construction,sibling=theorem]
\newkeytheorem{remark}[style=remark,sibling=theorem]
\newkeytheorem{example}[style=marked-definition,sibling=theorem]

% A custom tikzcd arrow tip, a lollipop (‚ä∏).
% https://tex.stackexchange.com/a/730357
\tikzset{
  % See section 4.4 ("Glyph arrow tips") of the tikzcd manual.
  % multimap/.tip={Glyph[glyph math command=circ, glyph length=1.03ex, glyph shorten=-0.2ex]},
  multimap/.tip={Circle[open]},
}

\title{Derivatives for Containers in Univalent Foundations}
\author{Philipp Joram}
\author{Niccol{\`o} Veltri}
\affil{Tallinn University of Technology, Estonia}
\date{}

\addbibresource{bibliography.bib}

\DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}

\newcommand*{\Op}[1]{\mathsf{#1}}
\DeclareMathOperator{\Type}{\Op{Type}}
\DeclareMathOperator{\Prop}{\Op{Prop}}
\DeclareMathOperator{\Set}{\Op{Set}}
\DeclareMathOperator{\W}{\Op{W}}
\DeclareMathOperator{\WRec}{\Op{W-rec}}
\DeclarePairedDelimiter{\Fin}{[}{]}
\DeclareMathOperator{\FinSet}{\Op{FinSet}}
\DeclareMathOperator{\El}{\Op{El}}
\DeclareMathOperator{\Sup}{\Op{sup}}
\DeclareMathOperator{\Dec}{\Op{Dec}}
\DeclareMathOperator{\DefEq}{\mathrel{\coloneq}}
\DeclareMathOperator{\JudgeEq}{\mathrel{\doteq}}
\DeclareMathOperator{\Fst}{\Op{fst}}
\DeclareMathOperator{\Snd}{\Op{snd}}
\DeclareMathOperator{\id}{\Op{id}}
\DeclareMathOperator{\Refl}{\Op{refl}}
\NewDocumentCommand{\Inv}{}{{\shortminus 1}}
\def\blankskip{0mu minus 1fill}
\NewDocumentCommand{\Blank}{}{{\mskip\blankskip\mathunderscore\mskip\blankskip}}

\DeclareMathOperator{\Fiber}{\Op{fiber}}
\DeclareMathOperator{\Singl}{\Op{singl}}
\DeclareMathOperator{\IsIsolated}{\Op{isIsolated}}
\DeclareMathOperator{\Isolate}{\Op{isolate}}
\DeclareMathOperator{\Replace}{\Op{replace}}
\DeclareMathOperator{\SigmaRemove}{\Op{\Sigma-remove}}
\DeclareMathOperator{\SigmaIsolate}{\Op{\Sigma-isolate}}

\newcommand*{\Isolated}[1]{#1^{\circ}}
\DeclareMathOperator{\Graft}{\Op{graft}}
\DeclarePairedDelimiterXPP{\GraftSyntaxX}[3]%
  {}%
  {[}%
  {]}%
  {_{#3}}%
  {#2 \delimsize\vert #1}
\DeclarePairedDelimiterX{\GraftSyntax}[2]{[}{]}{#2 \delimsize\vert #1}
\DeclarePairedDelimiter{\Ext}{\llbracket}{\rrbracket}
\NewDocumentCommand{\Alg}{m}{\operatorname{\Op{Alg}}_{#1}}
\DeclareMathOperator{\Rec}{\Op{rec}}

\newcommand*{\MkCont}[2]{#1\mathbin{\triangleleft}#2}
\DeclareMathOperator{\Sh}{\Op{Sh}}
\DeclareMathOperator{\Ps}{\Op{Ps}}

\NewDocumentCommand{\CTimes}{}{\mathbin{\times}}
\NewDocumentCommand{\CPlus}{}{\mathbin{+}}
\NewDocumentCommand{\CConst}{}{\Op{k}}
\NewDocumentCommand{\CYo}{}{\Op{y}}
\DeclarePairedDelimiterXPP{\Wk}[1]%
  {} % pre-code
  {\langle} % left
  {\rangle} % right
  {^{\uparrow}} % post-code
  {#1} % body
\newcommand*{\Subst}[2]{#1[#2]}
\DeclareMathOperator{\Bag}{\Op{Bag}}

\DeclarePairedDelimiterX{\PropTrunc}[1]%
  {\lVert} % left
  {\rVert} % right
  {#1} % body

\newcommand*{\Cart}[2]{#1\mathrel{\multimap}#2}
\NewDocumentCommand{\CartEquiv}{}{\multimapboth}
\newcommand*{\CartIso}[2]{#1 \mathrel{\CartEquiv} #2}

\DeclareMathOperator{\Cont}{\Op{Cont}}
\NewDocumentCommand{\ContCart}{}{\operatorname{\Cont}^{{\scriptscriptstyle\multimap}}}
\NewDocumentCommand{\IContCart}{m}{#1\operatorname{\Op{-Cont}}^{{\scriptscriptstyle\multimap}}}

\NewDocumentCommand{\Der}{}{\partial}
\NewDocumentCommand{\Id}{}{\Op{Id}}
\NewDocumentCommand{\Proj}{m}{\pi_{#1}}
\DeclareMathOperator{\Chain}{\Op{chain}}
\DeclareMathOperator{\In}{\Op{in}}
\DeclareMathOperator{\Out}{\Op{out}}
\DeclareMathOperator{\MuRule}{\Op{\mu-rule}}

\DeclareMathOperator{\WIn}{\Op{W-in}}
\DeclareMathOperator{\WPathIn}{\Op{\bar{W}-in}}
\DeclareMathOperator{\WPath}{\Op{\bar{W}}}
\DeclareMathOperator{\WTop}{\Op{top}}
\DeclareMathOperator{\WBelow}{\Op{below}}

\DeclareMathOperator{\Inl}{\Op{inl}}
\DeclareMathOperator{\Inr}{\Op{inr}}

\NewDocumentCommand{\Maybe}{m}{#1 \CTimes \Id}
\DeclareMathOperator{\Nothing}{\Op{nothing}}
\DeclareMathOperator{\Just}{\Op{just}}

\begin{document}

\maketitle

\begin{abstract}
  Containers conveniently represent a wide class of inductive data types.
  Their derivatives compute representations of types of one-hole contexts,
  useful for implementing tree-traversal algorithms.
  In the category of containers and cartesian morphisms,
  derivatives of discrete containers (whose positions have decidable equality) satisfy a universal property.

  Working in Univalent Foundations, we extend the derivative operation to \emph{untruncated} containers (whose shapes and positions are arbitrary types).
  We prove that this derivative, defined in terms of a set of \emph{isolated positions},
  satisfies an appropriate universal property in the wild category of untruncated containers and cartesian morphisms,
  as well as basic laws with respect to constants, sums and products.
  A chain rule exists, but is in general non-invertible.
  In fact, a globally invertible chain rule is inconsistent in the presence of non-set types,
  and equivalent to a classical principle when restricted to set-truncated containers.
  We derive a rule for derivatives of smallest fixed points from the chain rule,
  and characterize its invertibility.
  All of our results are formalized in Cubical Agda.
\end{abstract}

\input{introduction}
\input{isolated-points}
\input{derivatives}
\input{chain-rule}
\input{fixed-points}
\input{conclusion}


\paragraph{Acknowledgements.}
This work was supported by the Estonian Research Council grant PSG749.

\printbibliography

\end{document}
